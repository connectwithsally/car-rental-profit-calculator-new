<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Car Rental Profit Leak Audit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ===== PREMIUM DESIGN UPGRADE ===== */
body {
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #e5e7eb;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  margin: 0;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 300px;
  background: linear-gradient(135deg, #2563eb, #7c3aed);
  clip-path: polygon(0 0, 100% 0, 100% 70%, 0 100%);
  z-index: -1;
}

.container {
  max-width: 520px;
  margin: auto;
  padding: 20px;
  position: relative;
  z-index: 1;
}

.step { 
  display: none;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.4s ease;
}
.step.active { 
  display: block;
  opacity: 1;
  transform: translateY(0);
}

/* Premium Cards */
.card {
  background: rgba(30, 41, 59, 0.8);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

/* Premium Buttons */
button {
  width: 100%;
  padding: 16px;
  margin-top: 16px;
  background: linear-gradient(135deg, #2563eb, #7c3aed);
  border: none;
  color: white;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
}

button:active {
  transform: translateY(0);
}

/* Input Styling */
input, select {
  width: 100%;
  padding: 14px;
  margin-top: 12px;
  background: rgba(15, 23, 42, 0.8);
  color: white;
  border: 1px solid #334155;
  border-radius: 10px;
  font-size: 16px;
  transition: all 0.3s ease;
}

input:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
}

/* Leak Visualization - THE TRAP */
.leak-visual {
  margin: 30px 0;
}

.pipe {
  height: 50px;
  background: #0f172a;
  border-radius: 25px;
  position: relative;
  overflow: hidden;
  border: 2px solid #334155;
}

.leak-flow {
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg, 
    #16a34a 0%, 
    #16a34a var(--profit-percent, 50%), 
    #dc2626 var(--profit-percent, 50%), 
    #dc2626 100%);
  transition: all 1s ease;
  position: relative;
}

.leak-flow::after {
  content: '';
  position: absolute;
  top: 0;
  left: var(--profit-percent, 50%);
  width: 3px;
  height: 100%;
  background: white;
  box-shadow: 0 0 10px white;
}

.leak-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
  font-size: 14px;
}

.profit-label { color: #16a34a; }
.leak-label { color: #dc2626; }

/* Control Gap Meter */
.control-gap {
  background: rgba(220, 38, 38, 0.1);
  border: 2px solid rgba(220, 38, 38, 0.3);
  border-radius: 16px;
  padding: 24px;
  margin: 30px 0;
  text-align: center;
}

.control-meter {
  height: 20px;
  background: linear-gradient(90deg, #dc2626, #f59e0b, #16a34a);
  border-radius: 10px;
  margin: 20px 0;
  position: relative;
  overflow: hidden;
}

.control-fill {
  height: 100%;
  width: 0%;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  transition: width 1s ease;
}

.control-statement {
  font-size: 18px;
  font-weight: 600;
  margin: 20px 0;
}

/* Blur Effect for Email Capture */
.blur {
  filter: blur(8px);
  user-select: none;
  position: relative;
  transition: all 0.5s ease;
}

.blur::after {
  content: "üîí Enter email to reveal";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(15, 23, 42, 0.9);
  padding: 12px 20px;
  border-radius: 10px;
  border: 2px solid #2563eb;
  color: white;
  font-weight: bold;
  z-index: 2;
}

/* Top Leaks Display */
.leak-list {
  margin: 30px 0;
}

.leak-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  margin: 10px 0;
  background: rgba(220, 38, 38, 0.1);
  border-left: 4px solid #dc2626;
  border-radius: 8px;
}

.leak-amount {
  font-size: 24px;
  font-weight: 800;
  color: #dc2626;
}

/* Progress Indicator */
.progress {
  display: flex;
  justify-content: space-between;
  margin: 30px 0;
  position: relative;
}

.progress::before {
  content: '';
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  height: 3px;
  background: #334155;
  z-index: 1;
}

.progress-step {
  width: 40px;
  height: 40px;
  background: #334155;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  position: relative;
  z-index: 2;
}

.progress-step.active {
  background: #2563eb;
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.3);
}

/* Animations */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.pulse {
  animation: pulse 2s infinite;
}

/* Mobile Responsive */
@media (max-width: 600px) {
  .container {
    padding: 15px;
  }
  
  .card {
    padding: 20px;
  }
  
  button {
    padding: 14px;
  }
}
</style>
</head>

<body>
<div class="container">

<!-- STEP 0: INTRO -->
<div class="step active" id="step0">
  <div class="card" style="text-align: center;">
    <h1 style="font-size: 32px; margin-bottom: 10px; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
      üöó Profit Leak Audit
    </h1>
    <p style="font-size: 18px; color: #cbd5e1;">
      Discover where your rental profits <span style="color: #dc2626;">silently disappear</span>
    </p>
    <div style="margin: 30px 0;">
      <div style="display: inline-block; background: rgba(37, 99, 235, 0.2); padding: 8px 20px; border-radius: 20px; color: #60a5fa; font-size: 14px;">
        ‚è±Ô∏è 2-minute diagnostic ‚Ä¢ üìä 2,500+ hosts
      </div>
    </div>
    <button onclick="nextStep()" class="pulse">Start Free Audit ‚Üí</button>
  </div>
</div>

<!-- STEP 1: OPERATION TYPE -->
<div class="step" id="step1">
  <div class="card">
    <h2>How do you rent your cars?</h2>
    <p style="color: #94a3b8;">This determines where your leaks come from</p>
    
    <button onclick="setOperation('platform')" style="text-align: left; padding: 20px; margin-top: 15px; background: rgba(30, 41, 59, 0.8); border: 2px solid #334155;">
      <div style="font-size: 20px;">üì±</div>
      <strong>Platform Host</strong><br>
      <small style="color: #94a3b8;">Turo, Getaround, etc.</small>
    </button>
    
    <button onclick="setOperation('private')" style="text-align: left; padding: 20px; margin-top: 15px; background: rgba(30, 41, 59, 0.8); border: 2px solid #334155;">
      <div style="font-size: 20px;">üîë</div>
      <strong>Private / Direct</strong><br>
      <small style="color: #94a3b8;">Your own bookings</small>
    </button>
    
    <button onclick="setOperation('beginner')" style="text-align: left; padding: 20px; margin-top: 15px; background: rgba(30, 41, 59, 0.8); border: 2px solid #334155;">
      <div style="font-size: 20px;">üîç</div>
      <strong>Planning to Start</strong><br>
      <small style="color: #94a3b8;">Just researching</small>
    </button>
  </div>
  
  <div class="progress">
    <div class="progress-step active">1</div>
    <div class="progress-step">2</div>
    <div class="progress-step">3</div>
    <div class="progress-step">4</div>
    <div class="progress-step">5</div>
  </div>
</div>

<!-- STEP 2: VEHICLE BASICS -->
<div class="step" id="step2">
  <div class="card">
    <h2>Vehicle Basics</h2>
    <p style="color: #94a3b8;">Let's start with what you see</p>
    
    <label style="display: block; margin-top: 20px;">Number of cars</label>
    <input type="range" id="cars" min="1" max="20" value="1" oninput="document.getElementById('carsValue').textContent = this.value">
    <div style="text-align: center; font-size: 24px; font-weight: bold; color: #60a5fa;">
      <span id="carsValue">1</span> <span style="font-size: 16px; color: #94a3b8;">vehicles</span>
    </div>
    
    <label style="display: block; margin-top: 20px;">Average daily rate</label>
    <input type="range" id="rate" min="20" max="500" value="75" oninput="document.getElementById('rateValue').textContent = '$' + this.value">
    <div style="text-align: center; font-size: 24px; font-weight: bold; color: #60a5fa;">
      <span id="rateValue">$75</span> <span style="font-size: 16px; color: #94a3b8;">per day</span>
    </div>
    
    <label style="display: block; margin-top: 20px;">Booked days per month</label>
    <input type="range" id="days" min="1" max="30" value="15" oninput="document.getElementById('daysValue').textContent = this.value + ' days'">
    <div style="text-align: center; font-size: 24px; font-weight: bold; color: #60a5fa;">
      <span id="daysValue">15 days</span>
    </div>
  </div>
  
  <button onclick="nextStep()">Continue to Hidden Costs ‚Üí</button>
  
  <div class="progress">
    <div class="progress-step">1</div>
    <div class="progress-step active">2</div>
    <div class="progress-step">3</div>
    <div class="progress-step">4</div>
    <div class="progress-step">5</div>
  </div>
</div>

<!-- STEP 3: HIDDEN COSTS -->
<div class="step" id="step3">
  <div class="card">
    <h2>üí∏ Hidden Profit Leaks</h2>
    <p style="color: #94a3b8;">These are what most hosts miss</p>
    
    <label style="display: block; margin-top: 20px;">
      <span id="feeLabel">Platform fees</span>: 
      <span id="feeValue" style="color: #dc2626;">25%</span>
    </label>
    <input type="range" id="fees" min="5" max="40" value="25" oninput="updateFeeLabel()">
    
    <label style="display: block; margin-top: 20px;">
      Idle days per month (cleaning, repairs, no bookings):
      <span id="idleValue" style="color: #dc2626;">5 days</span>
    </label>
    <input type="range" id="idle" min="0" max="15" value="5" oninput="document.getElementById('idleValue').textContent = this.value + ' days'">
    
    <label style="display: block; margin-top: 20px;">
      Hours per week on admin (messages, scheduling):
      <span id="hoursValue" style="color: #dc2626;">12 hours</span>
    </label>
    <input type="range" id="hours" min="0" max="40" value="12" oninput="document.getElementById('hoursValue').textContent = this.value + ' hours'">
  </div>
  
  <button onclick="calculateResults()">üîç See My Profit Leaks</button>
  
  <div class="progress">
    <div class="progress-step">1</div>
    <div class="progress-step">2</div>
    <div class="progress-step active">3</div>
    <div class="progress-step">4</div>
    <div class="progress-step">5</div>
  </div>
</div>

<!-- STEP 4: RESULTS (THE TRAP) -->
<div class="step" id="step4">
  <div class="card">
    <h2 style="text-align: center;">üìä Your Profit Leak Analysis</h2>
    
    <!-- LEAK VISUALIZATION -->
    <div class="leak-visual">
      <div class="pipe">
        <div class="leak-flow" id="leakFlow"></div>
      </div>
      <div class="leak-labels">
        <span class="profit-label" id="profitLabel">Your Profit: $0</span>
        <span class="leak-label" id="leakLabel">Leaks: $0</span>
      </div>
    </div>
    
    <!-- CONTROL GAP -->
    <div class="control-gap">
      <h3>üö® Control Reality Check</h3>
      <div class="control-meter">
        <div class="control-fill" id="controlFill"></div>
      </div>
      <p class="control-statement" id="controlStatement">
        You control <strong id="controlPercent">0%</strong> of your outcome
      </p>
      <p style="color: #94a3b8; font-size: 14px;" id="controlSubtext">
        Your business grows when circumstances allow it
      </p>
    </div>
    
    <!-- TOP 3 LEAKS -->
    <div class="leak-list">
      <h3>Your Top 3 Profit Leaks</h3>
      <div class="leak-item">
        <div>
          <strong id="leak1Name">Platform Fees</strong><br>
          <small id="leak1Desc">Turo/Getaround commission</small>
        </div>
        <div class="leak-amount" id="leak1Amount">$0</div>
      </div>
      <div class="leak-item">
        <div>
          <strong id="leak2Name">Idle Time</strong><br>
          <small id="leak2Desc">Unbooked days & downtime</small>
        </div>
        <div class="leak-amount" id="leak2Amount">$0</div>
      </div>
      <div class="leak-item">
        <div>
          <strong id="leak3Name">Admin Work</strong><br>
          <small id="leak3Desc">Unpaid guest communication</small>
        </div>
        <div class="leak-amount" id="leak3Amount">$0</div>
      </div>
    </div>
    
    <!-- EFFECTIVE HOURLY (BLURRED) -->
    <div class="card blur" id="hourlyCard">
      <h3>‚è∞ Effective Hourly Earnings</h3>
      <div style="font-size: 32px; font-weight: 800; text-align: center;" id="hourlyAmount">
        $0.00<span style="font-size: 16px; color: #94a3b8;">/hour</span>
      </div>
      <p style="text-align: center; color: #94a3b8;" id="hourlyNote">
        After accounting for all unpaid work
      </p>
    </div>
    
    <!-- EMAIL CAPTURE -->
    <div class="card" style="text-align: center; background: rgba(37, 99, 235, 0.1); border: 2px solid #2563eb;">
      <h3>üîì Unlock Complete Analysis</h3>
      <p>Get your personalized Profit Leak Report with exact fixes</p>
      <input type="email" id="email" placeholder="your@email.com" style="margin: 20px 0;">
      <button onclick="saveLead()" class="pulse">üì© Get My Free Report</button>
      <p style="font-size: 12px; color: #94a3b8; margin-top: 10px;">
        No spam ‚Ä¢ 100% free ‚Ä¢ Used by 2,500+ hosts
      </p>
    </div>
  </div>
  
  <button onclick="restart()" style="background: transparent; border: 1px solid #334155; margin-top: 20px;">
    ‚Üª Start Over
  </button>
</div>

</div>

<script>
// ===== SUPABASE CONFIG =====
const SUPABASE_URL = "https://mfuoltkdoocdpurqytzt.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mdW9sdGtkb29jZHB1cnF5dHp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1MDQ3ODAsImV4cCI6MjA4NDA4MDc4MH0.MVTJr-CJUuuOxqeiLJ0F9tGeXP89krdxiWMdl6Ux6GA";

// ===== USER DATA =====
let userData = {
  operation: '',
  cars: 1,
  rate: 75,
  days: 15,
  fees: 25,
  idle: 5,
  hours: 12
};

// ===== STEP MANAGEMENT =====
let currentStep = 0;

function nextStep() {
  document.getElementById('step' + currentStep).classList.remove('active');
  currentStep++;
  document.getElementById('step' + currentStep).classList.add('active');
  
  // Update progress indicators
  document.querySelectorAll('.progress-step').forEach((step, index) => {
    if (index < currentStep) {
      step.classList.add('active');
    } else {
      step.classList.remove('active');
    }
  });
}

function setOperation(type) {
  userData.operation = type;
  nextStep();
}

function updateFeeLabel() {
  const feeValue = document.getElementById('fees').value;
  document.getElementById('feeValue').textContent = feeValue + '%';
  userData.fees = parseInt(feeValue);
  
  const feeLabel = document.getElementById('feeLabel');
  if (userData.operation === 'platform') {
    feeLabel.textContent = 'Platform fees';
  } else if (userData.operation === 'private') {
    feeLabel.textContent = 'Payment friction';
  } else {
    feeLabel.textContent = 'Platform fees/Payment friction';
  }
}

// ===== CALCULATION ENGINE =====
function calculateResults() {
  // Get values
  userData.cars = parseInt(document.getElementById('cars').value);
  userData.rate = parseInt(document.getElementById('rate').value);
  userData.days = parseInt(document.getElementById('days').value);
  userData.fees = parseInt(document.getElementById('fees').value);
  userData.idle = parseInt(document.getElementById('idle').value);
  userData.hours = parseInt(document.getElementById('hours').value);
  
  // Calculate
  const revenue = userData.cars * userData.rate * userData.days;
  const platformLeak = revenue * (userData.fees / 100);
  const idleLeak = userData.cars * userData.rate * userData.idle;
  const adminLeak = userData.hours * 4 * 25; // $25/hour opportunity cost
  
  const totalLeaks = platformLeak + idleLeak + adminLeak;
  const netProfit = revenue - totalLeaks;
  
  // Percentages
  const profitPercent = (netProfit / revenue) * 100;
  const leakPercent = 100 - profitPercent;
  
  // Hourly earnings
  const monthlyHours = userData.hours * 4.33;
  const effectiveHourly = netProfit / monthlyHours;
  
  // Control percentage (the psychological trap)
  let controlPercent = 50; // Base
  
  if (userData.operation === 'platform') controlPercent -= 20;
  if (userData.operation === 'private') controlPercent += 15;
  if (userData.hours > 15) controlPercent -= 10;
  if (userData.idle > 7) controlPercent -= 5;
  
  controlPercent = Math.max(15, Math.min(85, Math.round(controlPercent)));
  
  // ===== UPDATE UI =====
  
  // Leak visualization
  document.getElementById('leakFlow').style.setProperty('--profit-percent', `${profitPercent}%`);
  document.getElementById('profitLabel').textContent = `Your Profit: $${Math.round(netProfit).toLocaleString()}`;
  document.getElementById('leakLabel').textContent = `Leaks: $${Math.round(totalLeaks).toLocaleString()}`;
  
  // Control gap
  document.getElementById('controlFill').style.width = `${controlPercent}%`;
  document.getElementById('controlPercent').textContent = `${controlPercent}%`;
  
  let statement = '';
  let subtext = '';
  
  if (controlPercent < 30) {
    statement = 'You control very little of your outcome';
    subtext = 'Your business grows when the platform allows it';
  } else if (controlPercent < 60) {
    statement = 'You have moderate control of your outcome';
    subtext = 'External factors heavily influence your growth';
  } else {
    statement = 'You have good control of your outcome';
    subtext = 'You can systematically grow your business';
  }
  
  document.getElementById('controlStatement').innerHTML = `You control <strong>${controlPercent}%</strong> of your outcome`;
  document.getElementById('controlSubtext').textContent = subtext;
  
  // Top leaks
  const leaks = [
    { 
      name: userData.operation === 'platform' ? 'Platform Fees' : 'Payment Friction',
      desc: userData.operation === 'platform' ? 'Turo/Getaround commission' : 'Payment processing fees',
      amount: platformLeak
    },
    { 
      name: 'Idle Time',
      desc: 'Unbooked days & vehicle downtime',
      amount: idleLeak
    },
    { 
      name: 'Admin Work',
      desc: 'Guest communication & logistics',
      amount: adminLeak
    }
  ];
  
  // Sort by amount
  leaks.sort((a, b) => b.amount - a.amount);
  
  document.getElementById('leak1Name').textContent = leaks[0].name;
  document.getElementById('leak1Desc').textContent = leaks[0].desc;
  document.getElementById('leak1Amount').textContent = `$${Math.round(leaks[0].amount).toLocaleString()}`;
  
  document.getElementById('leak2Name').textContent = leaks[1].name;
  document.getElementById('leak2Desc').textContent = leaks[1].desc;
  document.getElementById('leak2Amount').textContent = `$${Math.round(leaks[1].amount).toLocaleString()}`;
  
  document.getElementById('leak3Name').textContent = leaks[2].name;
  document.getElementById('leak3Desc').textContent = leaks[2].desc;
  document.getElementById('leak3Amount').textContent = `$${Math.round(leaks[2].amount).toLocaleString()}`;
  
  // Hourly earnings (blurred)
  document.getElementById('hourlyAmount').innerHTML = `$${effectiveHourly.toFixed(2)}<span style="font-size: 16px; color: #94a3b8;">/hour</span>`;
  
  // Store for Supabase
  window.calculatedData = {
    email: '',
    operator_type: userData.operation,
    cars: userData.cars,
    gross: Math.round(revenue),
    profit: Math.round(netProfit),
    hourly: parseFloat(effectiveHourly.toFixed(2)),
    control_percent: controlPercent,
    leaks: totalLeaks
  };
  
  // Move to results
  nextStep();
}

// ===== SAVE LEAD TO SUPABASE =====
async function saveLead() {
  const email = document.getElementById('email').value.trim();
  
  if (!email || !email.includes('@')) {
    alert('Please enter a valid email address');
    return;
  }
  
  // Unlock blurred content
  document.getElementById('hourlyCard').classList.remove('blur');
  
  // Add email to data
  window.calculatedData.email = email;
  
  // Save to Supabase
  try {
    const response = await fetch(`${SUPABASE_URL}/rest/v1/leads`, {
      method: "POST",
      headers: {
        "apikey": SUPABASE_ANON_KEY,
        "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
        "Content-Type": "application/json",
        "Prefer": "return=minimal"
      },
      body: JSON.stringify(window.calculatedData)
    });
    
    if (response.ok) {
      // Success - show confirmation
      const button = document.querySelector('button[onclick="saveLead()"]');
      button.innerHTML = '‚úÖ Report Sent!';
      button.style.background = '#16a34a';
      button.onclick = null;
      
      // Add download link
      const card = document.querySelector('.card[style*="background: rgba(37, 99, 235, 0.1)"]');
      card.innerHTML = `
        <h3>‚úÖ Report Sent Successfully!</h3>
        <p>Your Profit Leak Report is being generated and will arrive in your inbox shortly.</p>
        <p style="color: #94a3b8; font-size: 14px;">Check your email in 2-3 minutes.</p>
      `;
    } else {
      alert('Something went wrong. Please try again.');
    }
  } catch (error) {
    console.error('Error saving lead:', error);
    alert('Connection error. Please check your internet and try again.');
  }
}

// ===== RESTART =====
function restart() {
  currentStep = 0;
  document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
  document.getElementById('step0').classList.add('active');
  
  // Reset progress
  document.querySelectorAll('.progress-step').forEach((step, index) => {
    if (index === 0) {
      step.classList.add('active');
    } else {
      step.classList.remove('active');
    }
  });
  
  // Reset form
  document.getElementById('email').value = '';
  window.calculatedData = null;
}

// ===== INITIALIZE =====
document.addEventListener('DOMContentLoaded', function() {
  // Set initial slider values
  document.getElementById('cars').addEventListener('input', function() {
    userData.cars = parseInt(this.value);
  });
  
  document.getElementById('rate').addEventListener('input', function() {
    userData.rate = parseInt(this.value);
  });
  
  document.getElementById('days').addEventListener('input', function() {
    userData.days = parseInt(this.value);
  });
  
  document.getElementById('fees').addEventListener('input', updateFeeLabel);
  document.getElementById('idle').addEventListener('input', function() {
    userData.idle = parseInt(this.value);
  });
  
  document.getElementById('hours').addEventListener('input', function() {
    userData.hours = parseInt(this.value);
  });
  
  // Initialize fee label
  updateFeeLabel();
});
</script>

</body>
</html>
